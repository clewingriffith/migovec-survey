<?xml version="1.0"?>
<project name="migovec-survey" default="dist" xmlns:mig="http://migovec-survey.appspot.com" >

	<property name="build.dir" location="build" />
	<property name="dist.dir" location="dist" />
	<property name="src.dir" location="src" />
	<property name="zoom.levels" value="5" />

	<target name="build" description="rebuild any generated files eg. the tiles" depends="generate-tiles, find-duplicate-tiles, remove-duplicate-tiles">
	</target>

	<target name="dist" description="copy all artifacts to the dist folder" >
		<copy todir="dist/migovec-survey">
		<resources>
		<fileset dir="src">
		  <include name="**/app.yaml" />
		  <include name="**/*.html" />
		  <include name="**/*.py" />
		  <include name="static/**/*.*" />
		  <include name="survey/blank_tile.png" />
		</fileset>
		<fileset dir="build">
		  <include name="*.py" />
		</fileset>
		</resources>
		</copy>
		
		<copy todir="dist/migovec-survey/survey">
			<fileset dir="build/survey">
				<patternset>
					<include name="**/t_*.png"/>
				</patternset>
				<!-- only copy files bigger than 980 bytes to avoid 
				using up app engine resources on white tiles -->
				<!-- no longer needed <size value="980" when="more"/> -->
			</fileset>
		</copy>
		<copy todir="dist/migovec-survey/static/">
			<fileset dir="src">
				<include name="**/*.kml"/>
			</fileset>
		</copy>
	</target>
	
	<target name="clean" description="Deletes all non-src files generated by the build.">
		<delete dir="${build.dir}" />
		<delete dir="${dist.dir}"  />
	</target>
	
	<target name="deploy" 
      description="Uploads the application to App Engine.">
	<appcfg action="update" war="war" />
	</target>

	<target name="generate-tiles" description="Generate tiles">
		<exec executable="python">
			<arg value="createTiles.py" />
		</exec>
	</target>
	
	<target name="find-duplicate-tiles" description="Find duplicate tiles">
		<exec executable="python">
			<arg value="findDuplicateTiles.py" />
		</exec>
	</target>
	
	<target name="remove-duplicate-tiles" description="remove duplicate tiles">
		<exec executable="python">
			<arg value="removeDuplicateTiles.py" />
		</exec>
	</target>
	
</project>
